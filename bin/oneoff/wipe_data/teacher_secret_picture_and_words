#!/usr/bin/env ruby

# This script wipes secret picture and words from (~ 2,839,668) teachers.
# See: https://codedotorg.atlassian.net/browse/P20-202

require 'ruby-progressbar'
require_relative '../../../dashboard/config/environment'

progress_bar = ProgressBar.create(total: nil, format: 'Processed[%c]: |%W| %a')

affected_teachers = User.
  with_deleted.
  where(user_type: User::TYPE_TEACHER).
  where.not(secret_picture_id: nil)

affected_teachers.in_batches(of: 10_000) do |teachers_batch|
  progress_bar.progress += teachers_batch.update_all(secret_picture_id: nil, secret_words: nil)
end

progress_bar.finish
